name: Unit Tests

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]
    types: [opened, synchronize, reopened]

env:
  PYTHON_VERSION: '3.12'

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Basic validation
        run: |
          echo "✅ Infrastructure-only repository validation"
          echo "✅ Python dependencies installed successfully"
          python -c "import aws_cdk; print('CDK import successful')"
          echo "✅ Repository ready for infrastructure deployment"

  code-quality:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Infrastructure code validation
        run: |
          echo "✅ Infrastructure code structure validation"
          if find infrastructure/ -name "*.py" | grep -q .; then
            echo "✅ Infrastructure Python files found"
            python -c "import aws_cdk; print('✅ CDK imports working correctly')"
          else
            echo "⚠️ No infrastructure Python files found"
          fi